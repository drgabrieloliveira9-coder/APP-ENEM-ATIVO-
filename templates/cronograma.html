{% extends "base.html" %}

{% block title %}Cronograma - ENEM 2025 StudyApp{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-white mb-8 glow-text">üìÖ Gerador de Cronograma de Estudos</h1>

<div class="grid md:grid-cols-3 gap-6 mb-8">
    <div class="card rounded-xl p-6 col-span-2">
        <h2 class="text-2xl font-bold text-blue-300 mb-4">Monte seu Plano de Estudos</h2>
        
        <div id="cronograma-form" class="space-y-4">
            <div class="card rounded-xl p-4 border border-blue-700">
                <h3 class="font-bold text-blue-300 mb-3">Adicionar Item ao Cronograma</h3>
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" id="dia" placeholder="Ex: Segunda-feira" class="px-3 py-2 bg-slate-900 border border-blue-700 rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <select id="area" class="px-3 py-2 bg-slate-900 border border-blue-700 rounded-lg text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Selecione a √°rea</option>
                        {% for area in areas %}
                        <option value="{{ area.name }}">{{ area.name }}</option>
                        {% endfor %}
                    </select>
                    <select id="assunto" class="px-3 py-2 bg-slate-900 border border-blue-700 rounded-lg text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 col-span-2">
                        <option value="">Selecione o assunto</option>
                        {% for topic in topics %}
                        <option value="{{ topic.title }}" data-area="{{ topic.area_name }}">{{ topic.title }}</option>
                        {% endfor %}
                    </select>
                    <input type="number" id="duracao" placeholder="Dura√ß√£o (min)" min="15" max="480" class="px-3 py-2 bg-slate-900 border border-blue-700 rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <select id="prioridade" class="px-3 py-2 bg-slate-900 border border-blue-700 rounded-lg text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="Alta">Alta</option>
                        <option value="M√©dia" selected>M√©dia</option>
                        <option value="Baixa">Baixa</option>
                    </select>
                </div>
                <button onclick="adicionarItem()" class="mt-3 w-full btn-primary text-white px-4 py-2 rounded-lg">
                    + Adicionar ao Cronograma
                </button>
            </div>
            
            <div id="lista-cronograma" class="space-y-2">
            </div>
            
            <button onclick="exportarCronograma()" class="w-full bg-gradient-to-r from-green-600 to-green-500 text-white px-6 py-3 rounded-lg hover:from-green-700 hover:to-green-600 transition-all font-bold" disabled id="btn-exportar">
                üì• Exportar Cronograma (CSV)
            </button>
        </div>
    </div>
    
    <div class="space-y-6">
        <div class="card rounded-xl p-6 border border-blue-700">
            <h3 class="font-bold text-blue-300 mb-3">‚è∞ Dicas de Planejamento</h3>
            <ul class="space-y-2 text-sm text-gray-400">
                <li>‚Ä¢ Estude 2-4 horas por dia</li>
                <li>‚Ä¢ Fa√ßa pausas de 10 min a cada hora</li>
                <li>‚Ä¢ Revise conte√∫dos antigos semanalmente</li>
                <li>‚Ä¢ Priorize suas dificuldades</li>
            </ul>
        </div>
        
        <div class="card rounded-xl p-6 border border-yellow-700">
            <h3 class="font-bold text-yellow-300 mb-3">üìä Distribui√ß√£o Sugerida</h3>
            <ul class="space-y-1 text-sm text-gray-400">
                <li>30% Matem√°tica</li>
                <li>25% Linguagens</li>
                <li>25% Humanas</li>
                <li>20% Natureza</li>
            </ul>
        </div>
    </div>
</div>

<script>
let cronograma = [];

document.getElementById('area').addEventListener('change', function() {
    const areaSelecionada = this.value;
    const assuntoSelect = document.getElementById('assunto');
    const options = assuntoSelect.querySelectorAll('option');
    
    options.forEach(opt => {
        if (opt.value === '') {
            opt.style.display = 'block';
        } else if (opt.dataset.area === areaSelecionada || areaSelecionada === '') {
            opt.style.display = 'block';
        } else {
            opt.style.display = 'none';
        }
    });
    
    assuntoSelect.value = '';
});

function adicionarItem() {
    const dia = document.getElementById('dia').value;
    const area = document.getElementById('area').value;
    const assunto = document.getElementById('assunto').value;
    const duracao = document.getElementById('duracao').value;
    const prioridade = document.getElementById('prioridade').value;
    
    if (!dia || !assunto || !duracao) {
        alert('Preencha dia, assunto e dura√ß√£o!');
        return;
    }
    
    const item = {day: dia, area: area, topic: assunto, minutes: duracao, priority: prioridade};
    cronograma.push(item);
    
    atualizarLista();
    limparFormulario();
}

function atualizarLista() {
    const lista = document.getElementById('lista-cronograma');
    lista.innerHTML = '';
    
    cronograma.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'bg-slate-900/50 border border-blue-700 rounded-lg p-3 flex justify-between items-center';
        div.innerHTML = `
            <div>
                <span class="font-semibold text-blue-300">${item.day}</span> <span class="text-gray-400">-</span> <span class="text-gray-300">${item.topic}</span>
                <span class="text-sm text-gray-500">(${item.minutes}min - ${item.priority})</span>
            </div>
            <button onclick="removerItem(${index})" class="text-red-400 hover:text-red-300 transition-colors">‚úï</button>
        `;
        lista.appendChild(div);
    });
    
    document.getElementById('btn-exportar').disabled = cronograma.length === 0;
}

function removerItem(index) {
    cronograma.splice(index, 1);
    atualizarLista();
}

function limparFormulario() {
    document.getElementById('dia').value = '';
    document.getElementById('assunto').value = '';
    document.getElementById('duracao').value = '';
    document.getElementById('prioridade').value = 'M√©dia';
}

function exportarCronograma() {
    fetch('/cronograma', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({plan: cronograma})
    })
    .then(res => res.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'cronograma_enem_2025.csv';
        a.click();
    });
}
</script>
{% endblock %}
